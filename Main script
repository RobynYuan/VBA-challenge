Sub Yealy stock data ()

Dim ws As Worksheet
Dim starting_ws As Worksheet
Set starting_ws = ActiveSheet 'remember which worksheet is active in the beginning

For Each ws In ThisWorkbook.Worksheets
   ws.Activate

For Each ws In ThisWorkbook.Worksheets
   ws.Activate


        Dim Ticker As String
          Dim TotalStockvolumn As Double
          LastRow = Cells(Rows.Count, 1).End(xlUp).Row
         TotalStockvolumn = 0
          Dim summaryTableRow As Integer
            summaryTableRow = 2
           Dim Rowcounter As Double
           Rowcounter = 1
    
             For i = 2 To LastRow
          If Cells(i + 1, 1).Value <> Cells(i, 1).Value Then
           ' create summary table
            Ticker = Cells(i, 1).Value
          ' Writing to summary table
            Range("I" & summaryTableRow).Value = Ticker
            Range("L" & summaryTableRow).Value = TotalStockvolumn
            Range("J" & summaryTableRow).Value = yearlychange
            Range("K" & summaryTableRow).Value = percentagechange
            Range("K" & summaryTableRow).NumberFormat = "0.01%"
            
             If Range("J" & summaryTableRow).Value > 0 Then
                 Range("J" & summaryTableRow).Interior.ColorIndex = 4
          Else
                 Range("J" & summaryTableRow).Interior.ColorIndex = 3
          End If

            
    
           summaryTableRow = summaryTableRow + 1
             
            
            ' reset total
       TotalStockvolumn = 0
   

       


        Else
            ' add to total
            Rowcounter = Rowcounter + 1
            TotalStockvolumn = TotalStockvolumn + Cells(i, 7).Value
            yearlychange = Cells(i + 1, 6).Value - Cells((i - Rowcounter + 2), 3).Value
            percentagechange = (Cells(i, 6).Value - Cells((i - Rowcounter + 2), 3).Value) / Cells((i - Rowcounter + 2), 3).Value
            

    End If


    Next i

    Cells(1, 9) = "ticker"
    Cells(1, 10) = " Yearly Change"
    Cells(1, 11) = "percentage Change"
    Cells(1, 12) = "Total Stock volumn"
    
    If Range("J" & summaryTableRow).Value > 0 Then
        Cells(summaryTableRow, j).Interior.ColorIndex = 4
    ElseIf Range("J" & summaryTableRow).Value < 0 Then
    Cells(summaryTableRow, j).Interior.ColorIndex = 3
    
    End If
    Next ws



starting_ws.Activate 'activate the worksheet that was originally active

End Sub
